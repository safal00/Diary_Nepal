<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Challan HD</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body { font-family: 'Inter', sans-serif; padding: 20px; background: #f5f5f5; }
  .challan { width: 210mm; min-height: 297mm; margin: auto; background: #fff; padding: 30px; box-sizing: border-box; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  h1, h2 { text-align: center; margin-bottom: 5px; }
  .company-info { text-align: center; margin-bottom: 20px; }
  input { border: none; font-family: 'Inter', sans-serif; font-size: 1em; width: 100%; }
  input:focus { outline: 1px solid #333; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  table, th, td { border: 1px solid #333; }
  th, td { padding: 10px; text-align: left; }
  th { background: #eee; }
  .grand-total { text-align: right; font-weight: bold; font-size: 1.2em; }
  .btn { display: inline-block; margin: 10px 5px; padding: 10px 20px; font-size: 1em; cursor: pointer; }
</style>
</head>
<body>

<div class="challan" id="challan">
  <div class="company-info">
    <input type="text" id="companyName" value="Nepal Print Solution Pvt. Ltd." />
    <input type="text" id="companyAddress" value="Address: Kathmandu, Nepal | Phone: 01-XXXXXXX" />
  </div>

  <h2 contenteditable="true">Delivery Challan / Estimate</h2>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Rate</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" value="Item 1"></td>
        <td><input type="number" value="2" oninput="calculateAmount(this)"></td>
        <td><input type="number" value="140" oninput="calculateAmount(this)"></td>
        <td><input type="number" value="280" readonly></td>
      </tr>
      <tr>
        <td><input type="text" value="Item 2"></td>
        <td><input type="number" value="3" oninput="calculateAmount(this)"></td>
        <td><input type="number" value="100" oninput="calculateAmount(this)"></td>
        <td><input type="number" value="300" readonly></td>
      </tr>
    </tbody>
  </table>

  <button class="btn" onclick="addRow()">+ Add Item</button>

  <div class="grand-total">Grand Total: <span id="grandTotal">580</span></div>
</div>

<div style="text-align:center;">
  <button class="btn" onclick="window.print()">Print</button>
  <button class="btn" onclick="downloadImage()">Save as Image</button>
  <button class="btn" onclick="shareWhatsapp()">Share on WhatsApp</button>
</div>

<script>
function calculateAmount(element) {
  const row = element.closest('tr');
  const qty = parseFloat(row.cells[1].children[0].value) || 0;
  const rate = parseFloat(row.cells[2].children[0].value) || 0;
  row.cells[3].children[0].value = qty * rate;
  updateGrandTotal();
}

function updateGrandTotal() {
  let total = 0;
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  rows.forEach(row => {
    total += parseFloat(row.cells[3].children[0].value) || 0;
  });
  document.getElementById('grandTotal').innerText = total;
}

function addRow() {
  const table = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
  const newRow = table.insertRow();
  newRow.innerHTML = `
    <td><input type="text" value="New Item"></td>
    <td><input type="number" value="1" oninput="calculateAmount(this)"></td>
    <td><input type="number" value="0" oninput="calculateAmount(this)"></td>
    <td><input type="number" value="0" readonly></td>
  `;
}

function downloadImage() {
  html2canvas(document.getElementById('challan'), { scale: 3 }).then(canvas => {
    canvas.toBlob(function(blob) {
      const link = document.createElement('a');
      link.download = 'Delivery_Challan.png';
      link.href = URL.createObjectURL(blob);
      link.click();
    });
  });
}

function shareWhatsapp() {
  html2canvas(document.getElementById('challan'), { scale: 3 }).then(canvas => {
    canvas.toBlob(function(blob) {
      const file = new File([blob], "Delivery_Challan.png", { type: "image/png" });
      const reader = new FileReader();
      reader.onload = function() {
        const base64data = reader.result.split(',')[1]; // extract base64
        const waUrl = https://api.whatsapp.com/send?text=Check%20this%20Delivery%20Challan&attachment=${base64data};
        window.open(waUrl, '_blank');
      };
      reader.readAsDataURL(file);
    });
  });
}
</script>

</body>
</html>
