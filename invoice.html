<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Delivery Challan</title>

<style>
body{
  font-family: Arial;
  background:#f2f2f2;
}

.challan{
  width:900px;
  margin:auto;
  background:#fff;
  padding:25px;
}

h2{
  text-align:center;
  margin:0;
}

[contenteditable]{
  outline:none;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th,td{
  border:1px solid #000;
  padding:6px;
  text-align:center;
}

.controls{
  text-align:right;
  margin-bottom:10px;
}

button{
  padding:6px 12px;
  margin-left:5px;
  cursor:pointer;
}

tfoot td{
  border-top:2px solid #000;
  font-weight:bold;
}

@media print{
  .controls{
    display:none;
  }
  body{
    background:#fff;
  }
}
</style>
</head>

<body>

<div class="controls">
  <button onclick="addRow()">Add Row</button>
  <button onclick="removeRow()">Remove Row</button>
  <button onclick="window.print()">Print</button>
  <button onclick="saveImage()">Save Image</button>
</div>

<div class="challan" id="challan">

<h2 contenteditable="true">DELIVERY CHALLAN</h2>

<div contenteditable="true"><b>Company Name</b></div>
<div contenteditable="true">Address, Phone</div>

<br>

Buyer Name: <span contenteditable="true">Customer Name</span>

<table id="items">
<thead>
<tr>
<th>SN</th>
<th>Description of Goods</th>
<th>Qty</th>
<th>Size</th>
<th>SQ.FT</th>
<th>Rate</th>
<th>Amount</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td contenteditable="true"></td>
<td contenteditable="true" oninput="calculate(this)">1</td>
<td contenteditable="true" oninput="calculate(this)">2x3</td>
<td class="sqft">6</td>
<td contenteditable="true" oninput="calculate(this)">0</td>
<td class="amount">0</td>
</tr>
</tbody>

<tfoot>
<tr>
<td colspan="5"></td>
<td>Grand Total</td>
<td id="grandTotal">0</td>
</tr>
</tfoot>
</table>

</div>

<script>

function parseSize(size){
  size = size.toLowerCase().replace(/ /g,'');

  if(size.includes('x')){
    let parts = size.split('x');
    let w = parseFloat(parts[0]);
    let h = parseFloat(parts[1]);

    if(w>20 || h>20){
      return (w*h)/144;   // inches → sqft
    }else{
      return w*h;         // feet → sqft
    }
  }
  return 0;
}

function calculate(el){
  let row = el.parentElement;
  let qty = parseFloat(row.cells[2].innerText) || 0;
  let size = row.cells[3].innerText;
  let rate = parseFloat(row.cells[5].innerText) || 0;

  let sqft = parseSize(size);
  row.cells[4].innerText = sqft.toFixed(2);

  let amount = sqft * qty * rate;
  row.cells[6].innerText = amount.toFixed(2);

  updateGrandTotal();
}

function updateGrandTotal(){
  let total = 0;
  document.querySelectorAll(".amount").forEach(cell=>{
    total += parseFloat(cell.innerText) || 0;
  });
  document.getElementById("grandTotal").innerText = total.toFixed(2);
}

function addRow(){
  let table = document.querySelector("#items tbody");
  let rowCount = table.rows.length + 1;

  let row = table.insertRow();

  row.innerHTML = `
    <td>${rowCount}</td>
    <td contenteditable="true"></td>
    <td contenteditable="true" oninput="calculate(this)">1</td>
    <td contenteditable="true" oninput="calculate(this)">2x3</td>
    <td class="sqft">6</td>
    <td contenteditable="true" oninput="calculate(this)">0</td>
    <td class="amount">0</td>
  `;
}

function removeRow(){
  let table = document.querySelector("#items tbody");
  if(table.rows.length>1){
    table.deleteRow(-1);
    updateGrandTotal();
  }
}

function saveImage(){
  html2canvas(document.querySelector("#challan")).then(canvas=>{
    let link=document.createElement('a');
    link.download='challan.png';
    link.href=canvas.toDataURL();
    link.click();
  });
}

</script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

</body>
</html>
