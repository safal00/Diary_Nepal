<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invoice</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Inter;padding:20px;background:#e6f0ff;}
.invoice{width:210mm;min-height:297mm;margin:auto;background:#fff;padding:20px;box-shadow:0 0 15px rgba(0,0,0,.1);}
h1{text-align:center;color:#004aad;margin-bottom:20px;}
.row{display:flex;justify-content:space-between;margin-bottom:10px;}
.details div{width:48%;}
input{border:none;border-bottom:1px solid #004aad;width:100%;margin:4px 0;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table,th,td{border:1px solid #004aad;}
th{background:#cce0ff;padding:6px;}
td{padding:6px;}
.btn{background:#004aad;color:#fff;border:none;padding:6px 12px;margin:4px;cursor:pointer;}
.total{margin-left:auto;width:320px;margin-top:15px;font-weight:600;font-size:18px;}
@page{size:A4;margin:10mm;}
@media print{body{background:#fff;padding:0}.btn{display:none}.invoice{box-shadow:none}}
</style>
</head>

<body>

<div class="invoice" id="invoice">

<h1>TAX INVOICE</h1>

<div class="row">
<div>Invoice No: <input id="invoiceNo"></div>
<div>Date: <input id="invoiceDate"></div>
</div>

<div class="row details">
<div>
<b>Company Details</b>
<input placeholder="Company Name">
<input placeholder="Address / Phone">
</div>

<div>
<b>Buyer Details</b>
<input id="buyerName" placeholder="Buyer Name">
<input placeholder="Buyer Address">
<input placeholder="Buyer Phone">
</div>
</div>

<b>Items</b>

<table id="itemsTable">
<thead>
<tr>
<th>S.No</th>
<th>Description</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="btn" id="addItem">+ Add Item</button>

<div class="total">
Grand Total: â‚¹ <span id="total">0.00</span><br>
In Words: <span id="words">Zero Rupees Only</span>
</div>

<br>

<div class="row">
<div>Prepared By: <input value="abc"></div>
<div style="text-align:right;">Authorized Signature</div>
</div>

</div>

<div style="text-align:center;margin-top:20px;">
<button class="btn" onclick="window.print()">Print</button>
<button class="btn" onclick="downloadPDF()">Download PDF</button>
<button class="btn" onclick="shareWhatsapp()">Share Invoice Image</button>
</div>

<script>
const tbody=document.querySelector("#itemsTable tbody");

function addRow(){
const r=document.createElement("tr");
r.innerHTML=`
<td></td>
<td><input></td>
<td><input></td>
<td><input type="number" value="1"></td>
<td><input type="number" value="0"></td>
<td><input readonly></td>
<td><button class="btn">Remove</button></td>`;
tbody.appendChild(r);

const q=r.cells[3].querySelector("input");
const rate=r.cells[4].querySelector("input");
const amt=r.cells[5].querySelector("input");

function calc(){amt.value=(q.value*rate.value)||0;update();}
q.oninput=calc;rate.oninput=calc;

r.cells[6].onclick=()=>{r.remove();update();}
update();
}

document.getElementById("addItem").onclick=addRow;
addRow();

function update(){
let t=0;
[...tbody.rows].forEach((r,i)=>{
r.cells[0].innerText=i+1;
t+=parseFloat(r.cells[5].querySelector("input").value)||0;
});
document.getElementById("total").innerText=t.toFixed(2);
document.getElementById("words").innerText=toWords(t)+" Rupees Only";
}

function toWords(num){
const a=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];
const b=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
function w(n){
if(n<20)return a[n];
if(n<100)return b[Math.floor(n/10)]+" "+a[n%10];
if(n<1000)return a[Math.floor(n/100)]+" Hundred "+w(n%100);
if(n<100000)return w(Math.floor(n/1000))+" Thousand "+w(n%1000);
return w(Math.floor(n/100000))+" Lakh "+w(n%100000);
}
return num?w(Math.floor(num)):"Zero";
}

async function downloadPDF(){
const canvas=await html2canvas(document.getElementById("invoice"),{scale:2});
const img=canvas.toDataURL("image/png");
const {jsPDF}=window.jspdf;
const pdf=new jsPDF("p","mm","a4");
pdf.addImage(img,"PNG",0,0,210,(canvas.height*210)/canvas.width);
pdf.save("Invoice.pdf");
}

async function shareWhatsapp(){
const canvas=await html2canvas(document.getElementById("invoice"),{scale:2});
const blob=await new Promise(res=>canvas.toBlob(res));
const file=new File([blob],"Invoice.png",{type:"image/png"});

if(navigator.canShare && navigator.canShare({files:[file]})){
await navigator.share({
files:[file],
title:"Invoice",
text:"Invoice"
});
}else{
alert("Desktop browser cannot auto-send image.\nImage will download. Send manually in WhatsApp.");
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="Invoice.png";
a.click();
}
}
</script>

</body>
</html>
