<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Delivery Challan</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: 'Inter', sans-serif; padding:20px; background:#e6f0ff; }

.challan{
  width:210mm;
  min-height:297mm;
  margin:auto;
  background:#fff;
  padding:20px;
  box-shadow:0 0 15px rgba(0,0,0,.1);
}

h1{text-align:center;color:#004aad;margin-bottom:20px;}

.header-row, .details{display:flex;justify-content:space-between;margin-bottom:15px;}
.details div{width:48%;}
input{border:none;border-bottom:1px solid #004aad;width:100%;margin:4px 0;}

table{width:100%;border-collapse:collapse;margin-top:10px;}
table,th,td{border:1px solid #004aad;}
th{background:#cce0ff;padding:6px;}
td{padding:6px;}

.btn{
  background:#004aad;
  color:#fff;
  border:none;
  padding:6px 12px;
  margin:4px;
  cursor:pointer;
}

.totalBox{width:260px;margin-left:auto;margin-top:15px;font-weight:600;}

@page{size:A4;margin:10mm;}
@media print{
  body{background:#fff;padding:0;}
  .btn{display:none;}
  .challan{box-shadow:none;}
}
</style>
</head>

<body>

<div class="challan" id="challan">

<h1>Delivery Challan</h1>

<div class="header-row">
<div>Challan No: <input></div>
<div>Date: <input></div>
</div>

<div class="details">
<div>
<b>Company Details</b>
<input placeholder="Company Name">
<input placeholder="Address / Phone">
</div>

<div>
<b>Buyer Details</b>
<input placeholder="Buyer Name">
<input placeholder="Buyer Address">
<input placeholder="Buyer Phone">
</div>
</div>

<b>Items</b>

<table id="itemsTable">
<thead>
<tr>
<th>S.No</th>
<th>Description</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="btn" id="addItemBtn">+ Add Item</button>

<div class="totalBox">
<div>Grand Total: <span id="grandTotal">0</span></div>
<div>GST % <input id="gstPercent" value="18" style="width:60px;"></div>
<div>GST Amount: <span id="gstAmount">0</span></div>
<div style="font-size:18px;">Final Total: <span id="finalTotal">0</span></div>
</div>

</div>

<div style="text-align:center;margin-top:20px;">
<button class="btn" onclick="window.print()">Print</button>
<button class="btn" onclick="downloadPDF()">Download PDF</button>
<button class="btn" onclick="shareWhatsapp()">Share WhatsApp</button>
</div>

<script>
const tbody=document.querySelector("#itemsTable tbody");

function addItem(){
const row=document.createElement("tr");
row.innerHTML=`
<td></td>
<td><input></td>
<td><input></td>
<td><input type="number" value="1"></td>
<td><input type="number" value="0"></td>
<td><input readonly></td>
<td><button class="btn">Remove</button></td>
`;
tbody.appendChild(row);

const qty=row.cells[3].querySelector("input");
const rate=row.cells[4].querySelector("input");
const amt=row.cells[5].querySelector("input");

function calc(){
amt.value=(qty.value*rate.value)||0;
updateTotal();
}
qty.oninput=calc;
rate.oninput=calc;

row.cells[6].onclick=()=>{row.remove();updateTotal();};
updateTotal();
}

document.getElementById("addItemBtn").onclick=addItem;
document.getElementById("gstPercent").oninput=updateTotal;
addItem();

function updateTotal(){
let total=0;
[...tbody.rows].forEach((r,i)=>{
r.cells[0].innerText=i+1;
total+=parseFloat(r.cells[5].querySelector("input").value)||0;
});

document.getElementById("grandTotal").innerText=total.toFixed(2);
const gst=total*(document.getElementById("gstPercent").value||0)/100;
document.getElementById("gstAmount").innerText=gst.toFixed(2);
document.getElementById("finalTotal").innerText=(total+gst).toFixed(2);
}

async function downloadPDF(){
const canvas=await html2canvas(document.getElementById("challan"),{scale:2});
const img=canvas.toDataURL("image/png");
const {jsPDF}=window.jspdf;
const pdf=new jsPDF("p","mm","a4");
pdf.addImage(img,"PNG",0,0,210,(canvas.height*210)/canvas.width);
pdf.save("Delivery_Challan.pdf");
}

function shareWhatsapp(){
const text=encodeURIComponent("Delivery Challan Ready");
if(/Android|iPhone/i.test(navigator.userAgent))
window.open(`https://wa.me/?text=${text}`);
else
window.open(`https://web.whatsapp.com/send?text=${text}`);
}
</script>

</body>
</html>
