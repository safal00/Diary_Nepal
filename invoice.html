<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Challan</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
body { font-family: 'Inter', sans-serif; padding: 20px; background: #e6f0ff; }
.challan { width: 210mm; min-height: 297mm; margin: auto; background: #fff; padding: 20px; box-sizing: border-box; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
h1 { text-align: center; margin-bottom: 20px; color: #004aad; }
.header-row { display: flex; justify-content: space-between; margin-bottom: 20px; }
.header-row div { font-weight: 600; color: #004aad; }
.header-row input { border: none; border-bottom: 1px solid #004aad; width: 150px; font-size: 1em; padding: 2px; }
.details { display: flex; justify-content: space-between; margin-bottom: 20px; }
.details div { width: 48%; }
.details input { border: none; border-bottom: 1px solid #004aad; font-size: 1em; width: 100%; margin: 5px 0; box-sizing: border-box; }
table { width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; }
table, th, td { border: 1px solid #004aad; }
th, td { padding: 6px; text-align: left; word-wrap: break-word; }
th { background: #cce0ff; }
.grand-total { text-align: right; font-weight: bold; font-size: 1.2em; margin-top: 10px; color: #004aad; }
.btn { display: inline-block; margin: 5px; padding: 6px 12px; font-size: 0.95em; cursor: pointer; background: #004aad; color: #fff; border: none; border-radius: 5px; }
.btn:hover { background: #003080; }
</style>
</head>
<body>

<div class="challan" id="challan">
  <h1>Delivery Challan</h1>

  <div class="header-row">
    <div>Challan No: <input type="text" id="challanNo" placeholder="____"></div>
    <div>Date: <input type="text" id="challanDate" placeholder="____"></div>
  </div>

  <div class="details">
    <div>
      <div style="font-weight:600; color:#004aad; margin-bottom:5px;">Company Details</div>
      <input type="text" id="companyName" placeholder="Company Name">
      <input type="text" id="companyAddress" placeholder="Address / Phone">
    </div>
    <div>
      <div style="font-weight:600; color:#004aad; margin-bottom:5px;">Buyer Details</div>
      <input type="text" id="buyerName" placeholder="Buyer Name">
      <input type="text" id="buyerAddress" placeholder="Buyer Address">
      <input type="text" id="buyerPhone" placeholder="Buyer Phone">
    </div>
  </div>

  <div style="font-weight:600; color:#004aad; margin-bottom:5px;">Items</div>
  <table id="itemsTable">
    <thead>
      <tr>
        <th style="width:4%;">S.No</th>
        <th style="width:35%;">Description of Goods</th>
        <th style="width:15%;">Size</th>
        <th style="width:10%;">Quantity</th>
        <th style="width:10%;">Rate</th>
        <th style="width:10%;">Amount</th>
        <th style="width:10%;">Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="btn" id="addItemBtn">+ Add Item</button>

  <div class="grand-total">Grand Total: <span id="grandTotal">0</span></div>
</div>

<div style="text-align:center; margin-top:20px;">
  <button class="btn" onclick="window.print()">Print</button>
  <button class="btn" onclick="downloadImage()">Save as Image</button>
  <button class="btn" onclick="shareWhatsapp()">Share on WhatsApp</button>
</div>

<script>
// Add Row Function
function addItemRow() {
  const tbody = document.querySelector('#itemsTable tbody');
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td></td>
    <td><input type="text" placeholder="Item description"></td>
    <td><input type="text" placeholder="Size"></td>
    <td><input type="number" value="1" min="0" oninput="calculateAmount(this)"></td>
    <td><input type="number" value="0" min="0" oninput="calculateAmount(this)"></td>
    <td><input type="number" value="0" readonly></td>
    <td><button class="btn removeBtn">Remove</button></td>
  `;
  tbody.appendChild(newRow);
  updateGrandTotal();
}

// Calculate Amount
function calculateAmount(el) {
  const row = el.closest('tr');
  const qty = parseFloat(row.cells[3].children[0].value) || 0;
  const rate = parseFloat(row.cells[4].children[0].value) || 0;
  row.cells[5].children[0].value = qty * rate;
  updateGrandTotal();
}

// Update Serial and Grand Total
function updateGrandTotal() {
  let total = 0;
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  rows.forEach((row, index) => {
    row.cells[0].innerText = index + 1;
    total += parseFloat(row.cells[5].children[0].value) || 0;
  });
  document.getElementById('grandTotal').innerText = total;
}

// Event delegation for Remove
document.querySelector('#itemsTable tbody').addEventListener('click', function(e){
  if(e.target && e.target.classList.contains('removeBtn')){
    e.target.closest('tr').remove();
    updateGrandTotal();
  }
});

// Add Item Button click
document.getElementById('addItemBtn').addEventListener('click', addItemRow);

// Add first empty row on load
addItemRow();

// Download as Image
function downloadImage() {
  html2canvas(document.getElementById('challan'), { scale: 3 }).then(canvas => {
    canvas.toBlob(function(blob) {
      const link = document.createElement('a');
      link.download = 'Delivery_Challan.png';
      link.href = URL.createObjectURL(blob);
      link.click();
    });
  });
}

// WhatsApp share
function shareWhatsapp() {
  html2canvas(document.getElementById('challan'), { scale: 2 }).then(canvas => {
    if(navigator.share){
      canvas.toBlob(blob=>{
        const file = new File([blob],"Delivery_Challan.png",{type:"image/png"});
        navigator.share({files:[file], text:"Delivery Challan"}).catch(e=>console.log(e));
      });
    }else{
      const text = encodeURIComponent("Check this Delivery Challan");
      window.open(https://web.whatsapp.com/send?text=${text}, '_blank');
    }
  });
}
</script>
</body>
</html>
