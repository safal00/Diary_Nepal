<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Customizable Delivery Table</title>
<style>
body{font-family:sans-serif; padding:20px;}
table{width:100%; border-collapse:collapse; margin-bottom:10px;}
th, td{border:1px solid #333; padding:5px; text-align:center;}
th{background:#f0f4f8;}
.action-buttons button{margin-right:5px; padding:6px 12px; cursor:pointer;}
.delete-col-btn{margin-left:5px; background:red; color:white; border:none; padding:2px 5px; cursor:pointer;}
</style>
</head>
<body>

<div class="action-buttons">
  <button onclick="addRow()">Add Row</button>
  <button onclick="removeRow()">Remove Row</button>
  <button onclick="printTable()">Print</button>
  <button onclick="saveTableImage()">Save as Image</button>
</div>

<table id="itemsTable">
<thead>
<tr id="tableHeader">
  <th>S.No <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Description <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Qty <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Size <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Square Foot <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Rate <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
  <th contenteditable="true">Amount <button class="delete-col-btn" onclick="deleteColumn(this)">x</button></th>
</tr>
</thead>
<tbody>
<tr>
  <td>1</td>
  <td contenteditable="true"></td>
  <td contenteditable="true" oninput="updateRow(this)">0</td>
  <td contenteditable="true" oninput="updateRow(this)"></td>
  <td contenteditable="true" oninput="updateRow(this)">0</td>
  <td contenteditable="true" oninput="updateRow(this)">0</td>
  <td>0</td>
</tr>
</tbody>
</table>

<div>Grand Total: <span id="grandTotal">0</span></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function addRow(){
  const table = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
  const newRow = table.insertRow();
  const colCount = document.getElementById('itemsTable').rows[0].cells.length;
  for(let i=0;i<colCount;i++){
    const cell = newRow.insertCell();
    if(i===0){cell.innerText = table.rows.length;}
    else if(i!==colCount-1){cell.contentEditable = true;}
    else{cell.innerText = 0;}
    if(i>=2 && i<=5) cell.setAttribute('oninput','updateRow(this)');
  }
  updateSerialNumbers();
}

function removeRow(){
  const table = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
  if(table.rows.length>1) table.deleteRow(table.rows.length-1);
  updateSerialNumbers();
  updateGrandTotal();
}

function updateSerialNumbers(){
  const table = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
  for(let i=0;i<table.rows.length;i++){
    table.rows[i].cells[0].innerText = i+1;
  }
}

function parseSizeToSqft(sizeText){
  if(!sizeText) return 0;
  sizeText = sizeText.toLowerCase().trim();
  let inch = sizeText.includes("inch");
  sizeText = sizeText.replace("inch","").replace("ft","").trim();
  let parts = sizeText.split('x');
  if(parts.length!==2) return 0;
  let w = parseFloat(parts[0]);
  let h = parseFloat(parts[1]);
  if(isNaN(w)||isNaN(h)) return 0;
  if(inch) return (w/12)*(h/12);
  return w*h;
}

function updateRow(cell){
  const row = cell.parentElement;
  let colNames = Array.from(document.getElementById('tableHeader').cells).map(c=>c.innerText.toLowerCase());
  let qtyCol = colNames.indexOf('qty');
  let sizeCol = colNames.indexOf('size');
  let sqftCol = colNames.indexOf('square foot');
  let rateCol = colNames.indexOf('rate');
  let amountCol = colNames.indexOf('amount');

  let qty = qtyCol>=0 ? parseFloat(row.cells[qtyCol].innerText)||0 : 0;
  let sizeText = sizeCol>=0 ? row.cells[sizeCol].innerText.trim() : '';
  let sqft = sqftCol>=0 ? parseSizeToSqft(sizeText)*qty : 0;
  if(sqftCol>=0) row.cells[sqftCol].innerText = sqft.toFixed(2);

  let rate = rateCol>=0 ? parseFloat(row.cells[rateCol].innerText)||0 : 0;
  if(amountCol>=0){
    if(sqftCol>=0){
      row.cells[amountCol].innerText = (sqft*rate).toFixed(2);
    }else{
      row.cells[amountCol].innerText = (qty*rate).toFixed(2);
    }
  }
  updateGrandTotal();
}

function updateGrandTotal(){
  const table = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
  let total =0;
  const colNames = Array.from(document.getElementById('tableHeader').cells).map(c=>c.innerText.toLowerCase());
  const amountCol = colNames.indexOf('amount');
  for(let i=0;i<table.rows.length;i++){
    if(amountCol>=0) total += parseFloat(table.rows[i].cells[amountCol].innerText)||0;
  }
  document.getElementById('grandTotal').innerText = total.toFixed(2);
}

// Delete column function
function deleteColumn(button){
  const th = button.parentElement;
  const index = th.cellIndex;
  const table = document.getElementById('itemsTable');
  // Remove th
  th.remove();
  // Remove each td in that column
  for(let i=0;i<table.tBodies[0].rows.length;i++){
    table.tBodies[0].rows[i].deleteCell(index);
  }
  updateSerialNumbers();
  updateGrandTotal();
}

function printTable(){ window.print(); }

function saveTableImage(){
  const wrapper = document.getElementById('itemsTable');
  html2canvas(wrapper,{scale:2}).then(canvas=>{
    const link = document.createElement('a');
    link.download = 'Table.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
}
</script>

</body>
</html>
