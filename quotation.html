<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Premium Quotation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:'Segoe UI',Arial;background:linear-gradient(120deg,#e8ecff,#f5f7ff);margin:0;padding:20px}
.container{max-width:1100px;margin:auto;background:#fff;padding:22px;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.12)}
.header{display:grid;grid-template-columns:1fr 1fr 1fr;align-items:center;gap:10px;margin-bottom:18px;padding:14px 0;border-bottom:2px solid #edf0f7}
.logo{display:block}
.logoBox{position:relative;display:inline-block}
.logoBox img{max-height:100px;max-width:220px;object-fit:contain;display:none}
.logoBox .removeX{display:none}
.logoBox.hasImage:hover .removeX{display:block}
.fileBtn{padding:6px 14px;background:#e9edff;border-radius:6px;border:1px solid #cfd6ff;cursor:pointer;font-size:13px;display:inline-block}
.fileBtn input{display:none}
.quote-badge{font-size:28px;font-weight:800;color:#2d4da5;letter-spacing:1px;text-align:center}
.quote-info{justify-self:end;text-align:right}
.info-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:10px;font-size:14px}
button{padding:8px 18px;border:none;border-radius:8px;background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;margin:6px 6px 6px 0;cursor:pointer;font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,.15)}
.table{width:100%;border-collapse:collapse;margin-top:14px;font-size:14px}
.table th{background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;padding:12px}
.table td{border:1px solid #e3e7f1;padding:9px;text-align:center}
.table tr:nth-child(even){background:#f7f9ff}
input[type='number']{width:70px;padding:5px;border-radius:6px;border:1px solid #ccc}
.designPreview{width:100%;height:100%;object-fit:cover;border-radius:8px;display:none}
.designCell{width:140px;height:110px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;padding:0;position:relative}
.removeX{position:absolute;top:4px;right:6px;background:rgba(0,0,0,.6);color:#fff;border:none;border-radius:50%;width:22px;height:22px;font-size:14px;cursor:pointer;display:none;line-height:20px}
.designCell.hasImage:hover .removeX{display:block;}
tr:hover .rowDelete{display:inline-block;}
.rowDelete{display:none;background:#ff4d4d !important;width:26px;height:26px;border-radius:50%;}
.footer{margin-top:25px;font-size:13px;color:#555;border-top:1px dashed #ddd;padding-top:12px}
.total-box{margin-top:18px;text-align:right;font-size:20px;font-weight:700;color:#1f3674}
b{color:#2d4da5}
@media(max-width:768px){
.header{grid-template-columns:1fr}
.info-grid{grid-template-columns:1fr}
.table{font-size:12px}
}
@media print{button,.fileBtn{display:none !important;}body{background:#fff;padding:0}.container{box-shadow:none;border-radius:0}}
</style>
</head>
<body>

<div class="container">

<div class="header">
  <div class="logo">
    <label class="fileBtn">Upload Logo <input type="file" id="logoInput" accept="image/*"></label>
    <br>
    <div class="logoBox" id="companyLogoBox">
      <img id="companyLogo" style="max-height:80px;margin-top:6px;display:none">
      <button class="removeX" onclick="removeLogo('companyLogo','logoInput','companyLogoBox')">×</button>
    </div>
  </div>
  <div contenteditable="true" class="quote-badge">QUOTATION</div>
  <div class="quote-info"></div>
</div>

<div class="info-grid">
  <div>
    <b>Company Details</b><br>
    Company Name: <span contenteditable="true"></span><br>
    Address: <span contenteditable="true"></span><br>
    Phone: <span contenteditable="true"></span>
  </div>

  <div>
    <b>Client Details</b><br>
    Client Name: <span contenteditable="true"></span><br>
    Address: <span contenteditable="true"></span><br>
    Phone: <span contenteditable="true"></span>
  </div>

  <div style="text-align:right">
    <b>Quotation Info</b><br>
    Quotation No: <span contenteditable="true"></span><br>
    Date: <span contenteditable="true"></span>
  </div>
</div>

<button onclick="addRow()">Add Item</button>
<button onclick="undoDelete()" id="undoBtn" style="display:none;background:linear-gradient(90deg,#ff9800,#ffb74d)">Undo</button>
<button onclick="undoDelete()" id="undoBtn" style="display:none;background:linear-gradient(90deg,#ff9800,#ffb74d)">Undo</button>
<button onclick="window.print()">Print</button>
<button onclick="downloadPDF()">Download PDF</button>

<table class="table" id="qTable">
<tr>
<th>S.No</th>
<th>Description</th>
<th>Design</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
</tr>
</table>

<div class="total-box">
Grand Total: Rs. <span id="grandTotal">0.00</span>
</div>

<div class="footer">
<br>
<div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:40px">

<div>
Prepared By:<br>
<span contenteditable="true" id="preparedBy" style="border-bottom:1px solid #aaa;min-width:160px;display:inline-block"></span>
<br><br>
<label class="fileBtn">Upload Logo <input type="file" id="preparedLogoInput" accept="image/*"></label>
<br>
<div class="logoBox" id="preparedLogoBox">
  <img id="preparedLogo" style="max-height:80px;margin-top:6px;display:none">
  <button class="removeX" onclick="removeLogo('preparedLogo','preparedLogoInput','preparedLogoBox')">×</button>
</div>
</div>

<div>
Approved By (Client):<br>
<span contenteditable="true" id="approvedBy" style="border-bottom:1px solid #aaa;min-width:160px;display:inline-block"></span>
<br><br>
<label class="fileBtn">Upload Logo <input type="file" id="approvedLogoInput" accept="image/*"></label>
<br>
<div class="logoBox" id="approvedLogoBox">
  <img id="approvedLogo" style="max-height:80px;margin-top:6px;display:none">
  <button class="removeX" onclick="removeLogo('approvedLogo','approvedLogoInput','approvedLogoBox')">×</button>
</div>
</div>

</div>
<br>
<b>Terms & Conditions</b><br>
1. Goods once sold not returnable.<br>
2. 50% advance required.<br>
3. Delivery within 7 days.
</div>

</div>

<script>
let count=0;
let lastDeletedRow=null;
let lastDeletedRow=null;
const table=document.getElementById('qTable');

function addRow(){
 count++;
 let row=table.insertRow();
 row.innerHTML=`
 <td style='position:relative'>${count}<button class='rowDelete' title='Delete Item' onclick='deleteRow(this)' style='position:absolute;top:4px;left:4px'>×</button></td>
 <td contenteditable='true'></td>
 <td class='designCell'>
   <label class='fileBtn uploadDesignBtn'>Upload Design <input type='file' accept='image/*' class='designInput'></label>
   <img class='designPreview'>
   <button class='removeX' title='Remove Photo' onclick='removePhoto(this)'>×</button>
 </td>
 <td contenteditable='true'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td class='amount'>0.00</td>
 `;
}

function deleteRow(btn){
 const row=btn.closest('tr');
 lastDeletedRow=row.cloneNode(true);
 row.remove();
 renumber();
 calculateTotal();
 document.getElementById('undoBtn').style.display='inline-block';
}

function calculateTotal(){
 let total=0;
 document.querySelectorAll('.amount').forEach(cell=>{
  total+=parseFloat(cell.innerText)||0;
 });
 document.getElementById('grandTotal').innerText=total.toFixed(2);
}

function undoDelete(){
 if(!lastDeletedRow) return;
 table.appendChild(lastDeletedRow);
 lastDeletedRow=null;
 renumber();
 calculateTotal();
 document.getElementById('undoBtn').style.display='none';
});
 document.getElementById('grandTotal').innerText=total.toFixed(2);
}

function undoDelete(){
 if(!lastDeletedRow) return;
 table.appendChild(lastDeletedRow);
 lastDeletedRow=null;
 renumber();
 calculateTotal();
 document.getElementById('undoBtn').style.display='none';
});
 document.getElementById('grandTotal').innerText=total.toFixed(2);
}

function downloadPDF(){
 window.print();
}

// ---------- LOGO PREVIEW ----------
function previewLogoFile(input,file){
 const img=document.getElementById('companyLogo');
 const box=document.getElementById('companyLogoBox');
 if(!img) return;
 const reader=new FileReader();
 reader.onload=function(e){
   img.src=e.target.result;
   img.style.display='block';
   if(box) box.classList.add('hasImage');
   if(input && input.closest('label')) input.closest('label').style.display='none';
   input.value='';
 };
 reader.readAsDataURL(file);
}

// ---------- DESIGN PREVIEW ----------
function previewDesignFile(input,file){
 const container=input.closest('td');
 if(!container) return;
 let img=container.querySelector('.designPreview');
 let label=container.querySelector('.uploadDesignBtn');
 const reader=new FileReader();
 reader.onload=function(e){
   img.src=e.target.result;
   img.style.display='block';
   if(label) label.style.display='none';
   container.classList.add('hasImage');
   input.value=''; // allow re‑upload after remove
 };
 reader.readAsDataURL(file);
}

function removePhoto(btn){
 const cell=btn.closest('td');
 const img=cell.querySelector('.designPreview');
 const label=cell.querySelector('.uploadDesignBtn');
 const input=cell.querySelector('.designInput');
 img.src='';
 img.style.display='none';
 cell.classList.remove('hasImage');
 if(label) label.style.display='inline-block';
 if(input) input.value=''; // important for re‑upload same photo
}

function removeLogo(imgId,inputId,boxId){
 const img=document.getElementById(imgId);
 const input=document.getElementById(inputId);
 const box=document.getElementById(boxId);
 if(img){ img.src=''; img.style.display='none'; }
 if(box) box.classList.remove('hasImage');
 if(input){ input.value=''; if(input.closest('label')) input.closest('label').style.display='inline-block'; }
}

// ---------- CAPITALIZE PREPARED BY ----------
function capitalizeWords(el){
 if(!el) return;
 let words=el.innerText.toLowerCase().split(' ');
 el.innerText=words.map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(' ');
}

// ---------- EVENTS ----------
document.addEventListener('change',function(e){
 if(e.target.id==='logoInput' && e.target.files && e.target.files[0]){
   previewLogoFile(e.target,e.target.files[0]);
 }
 if(e.target.id==='preparedLogoInput' && e.target.files && e.target.files[0]){
   const img=document.getElementById('preparedLogo');
   const box=document.getElementById('preparedLogoBox');
   const reader=new FileReader();
   reader.onload=function(ev){ 
     img.src=ev.target.result; 
     img.style.display='block';
     if(box) box.classList.add('hasImage');
     if(e.target.closest('label')) e.target.closest('label').style.display='none';
     e.target.value='';
   };
   reader.readAsDataURL(e.target.files[0]);
 }
 if(e.target.id==='approvedLogoInput' && e.target.files && e.target.files[0]){
   const img=document.getElementById('approvedLogo');
   const box=document.getElementById('approvedLogoBox');
   const reader=new FileReader();
   reader.onload=function(ev){ 
     img.src=ev.target.result; 
     img.style.display='block';
     if(box) box.classList.add('hasImage');
     if(e.target.closest('label')) e.target.closest('label').style.display='none';
     e.target.value='';
   };
   reader.readAsDataURL(e.target.files[0]);
 }
 if(e.target.classList.contains('designInput') && e.target.files && e.target.files[0]){
   previewDesignFile(e.target,e.target.files[0]);
 }
});

// capitalize when leaving Prepared By
setTimeout(()=>{
 const prep=document.querySelector('.footer span[contenteditable]');
 if(prep){ prep.addEventListener('blur',()=>capitalizeWords(prep)); }
},500);

// ---------- TESTS ----------
function runTests(){
 console.log('TEST 1: Add row');
 addRow();
 console.assert(document.querySelectorAll('#qTable tr').length>1,'Row not added');

 console.log('TEST 2: Total calculation');
 const row=document.querySelectorAll('#qTable tr')[1];
 row.cells[4].querySelector('input').value=2;
 row.cells[5].querySelector('input').value=50;
 calculate(row.cells[4].querySelector('input'));
 console.assert(parseFloat(document.getElementById('grandTotal').innerText)>=100,'Total wrong');

 console.log('All tests done');
}

window.onload=function(){ console.log('Quotation system ready'); };
</script>

</body>
</html>
