<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quotation</title>

<style>
body{font-family:Arial;padding:20px}

button{cursor:pointer}

.addBtn{
margin-bottom:10px;
background:#2a5fa5;
color:white;
border:none;
padding:6px 12px;
}

.undoBtn{
background:green;
color:white;
border:none;
padding:6px 12px;
margin-left:10px;
}

.delBtn{
background:red;
color:white;
border:none;
padding:5px 10px;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid #333;
padding:8px;
text-align:center;
}

th{
background:#2a5fa5;
color:white;
}

.designCell{
position:relative;
height:140px;
}

.fileInput{display:none;}

.designImg{
width:100%;
height:100%;
object-fit:contain;
display:none;
}

.fileBtn{
padding:5px 10px;
}

.removeBtn{
position:absolute;
top:5px;
right:5px;
background:red;
color:white;
border:none;
display:none;
}

.designCell:hover .removeBtn.show{
display:block;
}

/* PRINT CLEAN */
@media print{
.addBtn,.undoBtn,.delBtn,.removeBtn,.fileBtn,
th:last-child,td:last-child{
display:none !important;
}
}
</style>
</head>

<body>

<button class="addBtn" onclick="addRow()">Add Item</button>
<button class="undoBtn" onclick="undoDelete()">Undo Delete</button>

<table>
<thead>
<tr>
<th>S.No</th>
<th>Description</th>
<th>Design</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<script>

let tbody=document.getElementById("tbody");
let lastDeletedRow=null;
let lastDeletedIndex=null;

addRow();

function addRow(){

let n=tbody.rows.length+1;

let row=tbody.insertRow();

row.innerHTML=`
<td>${n}</td>
<td contenteditable></td>

<td class="designCell">

<input type="file" class="fileInput"
accept="image/*"
onchange="uploadPhoto(event,this)">

<button class="fileBtn"
onclick="this.previousElementSibling.click()">
Choose Photo
</button>

<img class="designImg">

<button class="removeBtn"
onclick="removePhoto(this)">‚ùå</button>

</td>

<td contenteditable></td>
<td contenteditable></td>
<td contenteditable></td>
<td>0</td>

<td>
<button class="delBtn"
onclick="deleteRow(this)">Delete</button>
</td>
`;
}

/* PHOTO UPLOAD */
function uploadPhoto(e,input){

let file=e.target.files[0];
if(!file) return;

let reader=new FileReader();

reader.onload=function(ev){

let cell=input.parentElement;
let img=cell.querySelector(".designImg");
let remove=cell.querySelector(".removeBtn");
let btn=cell.querySelector(".fileBtn");

img.src=ev.target.result;
img.style.display="block";

btn.style.display="none";   // hide choose button
remove.classList.add("show");

};

reader.readAsDataURL(file);
input.value="";
}

/* REMOVE PHOTO */
function removePhoto(btn){

let cell=btn.parentElement;
let img=cell.querySelector(".designImg");
let fileBtn=cell.querySelector(".fileBtn");

img.src="";
img.style.display="none";

btn.classList.remove("show");
fileBtn.style.display="inline-block";
}

/* DELETE ROW */
function deleteRow(btn){

if(!confirm("Delete this row?")) return;

let row=btn.closest("tr");
lastDeletedIndex=[...tbody.rows].indexOf(row);
lastDeletedRow=row.cloneNode(true);

row.remove();

updateSerial();
if(tbody.rows.length==0) addRow();
}

/* UNDO DELETE */
function undoDelete(){

if(!lastDeletedRow){
alert("Nothing to undo!");
return;
}

if(lastDeletedIndex>=tbody.rows.length)
tbody.appendChild(lastDeletedRow);
else
tbody.insertBefore(lastDeletedRow,tbody.rows[lastDeletedIndex]);

updateSerial();
lastDeletedRow=null;
}

/* SERIAL UPDATE */
function updateSerial(){
[...tbody.rows].forEach((r,i)=>{
r.cells[0].innerText=i+1;
});
}

</script>

</body>
</html>
