<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Quotation Template</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f0f4ff;
    margin: 0;
    padding: 20px;
}
.quotation-container {
    max-width: 900px;
    margin: auto;
    background: #fff;
    padding: 30px 40px;
    border-radius: 8px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}
h1 { text-align:center; color:#004080; margin-bottom:30px; }
.section { margin-bottom: 20px; }
.flex-container { display:flex; justify-content:space-between; }
.flex-container .box { width:48%; }
input, textarea {
    width: 100%; padding:6px 8px; margin-top:4px; margin-bottom:8px;
    font-size:14px; border:1px solid #ccc; border-radius:4px; background:#f9f9f9;
}
table { width:100%; border-collapse: collapse; margin-top:12px; }
table th, table td { padding:8px; text-align:left; }
table th { border-bottom: 1px solid #3399ff; background:#cce0ff; color:#003366; }
img.preview { width:80px; height:60px; object-fit: cover; display:block; }
button { padding:6px 14px; background:#0066cc; color:#fff; border:none; border-radius:4px; cursor:pointer; margin-top:5px; }
button:hover { background:#004080; }
.actions { text-align:center; margin-top:20px; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>

<div class="quotation-container" id="quotation">
<h1>QUOTATION</h1>

<div class="flex-container section">
  <div class="box" style="text-align:left;">
    <h3>Client Details</h3>
    <input type="text" placeholder="Client Name">
    <input type="text" placeholder="Company Name">
    <input type="text" placeholder="Address">
  </div>
  <div class="box" style="text-align:right;">
    <h3>Company Details</h3>
    <input type="text" placeholder="Company Name">
    <input type="text" placeholder="Address">
    <input type="text" placeholder="Phone / Email">
    <input type="text" placeholder="Date">
    <input type="text" placeholder="Quotation No.">
  </div>
</div>

<div class="section">
<table id="items-table">
<thead>
<tr>
<th>#</th>
<th>Description</th>
<th>Photo</th>
<th>Qty</th>
<th>Unit Price</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><input type="text" placeholder="Item Description"></td>
<td><input type="file" accept="image/*" onchange="previewImg(event,this)"><img class="preview"></td>
<td><input type="number" placeholder="0" oninput="updateRow(this)"></td>
<td><input type="number" placeholder="0" oninput="updateRow(this)"></td>
<td><input type="number" readonly placeholder="0"></td>
</tr>
</tbody>
</table>
<button onclick="addItem()">+ Add Item</button>
</div>

<div class="section">
  <input type="text" id="subtotal" placeholder="Subtotal" readonly>
  <input type="number" id="discount" placeholder="Discount (%)" oninput="calculateTotals()">
  <input type="text" id="grandtotal" placeholder="Grand Total" readonly>
  <input type="text" id="grandwords" placeholder="Grand Total (in words)" readonly>
</div>

<div class="section">
<h3>Terms & Conditions</h3>
<textarea placeholder="Enter terms & conditions..."></textarea>
</div>

<div class="section">
<h3>Signature</h3>
<input type="text" placeholder="Name / Position">
<input type="text" placeholder="Company / Contact">
</div>
</div>

<div class="actions">
<button onclick="printPage()">Print Quotation</button>
<button onclick="saveAsImage()">Save as Image</button>
<button onclick="exportAsPDF()">Save as PDF</button>
</div>

<script>
function addItem(){
  const table = document.querySelector('#items-table tbody');
  const count = table.rows.length + 1;
  const row = table.insertRow();
  row.innerHTML = `<td>${count}</td>
  <td><input type="text" placeholder="Item Description"></td>
  <td><input type="file" accept="image/*" onchange="previewImg(event,this)"><img class="preview"></td>
  <td><input type="number" placeholder="0" oninput="updateRow(this)"></td>
  <td><input type="number" placeholder="0" oninput="updateRow(this)"></td>
  <td><input type="number" readonly placeholder="0"></td>`;
}

function previewImg(event,input){
  const file = input.files[0];
  const img = input.nextElementSibling;
  if(file){ img.src = URL.createObjectURL(file); input.style.display='none'; }
}

function updateRow(el){
  const tr = el.closest('tr');
  const qty = +tr.cells[3].querySelector('input').value || 0;
  const price = +tr.cells[4].querySelector('input').value || 0;
  tr.cells[5].querySelector('input').value = qty*price;
  calculateTotals();
}

function calculateTotals(){
  let subtotal=0;
  document.querySelectorAll('#items-table tbody tr').forEach(r=>{
    subtotal += +r.cells[5].querySelector('input').value || 0;
  });
  document.getElementById('subtotal').value = subtotal;
  const discount = +document.getElementById('discount').value || 0;
  const grand = subtotal - (subtotal*discount/100);
  document.getElementById('grandtotal').value = grand.toFixed(2);
  document.getElementById('grandwords').value = convertToWords(Math.round(grand)) + " Only";
}

function convertToWords(num){
  if(num===0) return "Zero";
  const a=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"];
  const b=["","Ten","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];
  let res="";
  if(num>=100){ res+=a[Math.floor(num/100)]+" Hundred "; num%=100; }
  if(num>=20){ res+=b[Math.floor(num/10)]+" "+a[num%10]; }
  else if(num>0){ res+=a[num]; }
  return res.trim();
}

function printPage(){ window.print(); }

function saveAsImage(){
  html2canvas(document.getElementById('quotation')).then(canvas=>{
    const a=document.createElement('a');
    a.href=canvas.toDataURL(); a.download="Quotation.png"; a.click();
  });
}

async function exportAsPDF(){
  const canvas = await html2canvas(document.getElementById('quotation'));
  const imgData = canvas.toDataURL('image/png');
  const pdf = await PDFLib.PDFDocument.create();
  const page = pdf.addPage();
  const png = await pdf.embedPng(imgData);
  const {width, height} = page.getSize();
  const dims = png.scaleToFit(width,height);
  page.drawImage(png,{x:0,y:height-dims.height,width:dims.width,height:dims.height});
  const pdfBytes = await pdf.save();
  const blob = new Blob([pdfBytes], {type:'application/pdf'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download="Quotation.pdf"; link.click();
}
</script>

</body>
</html>
