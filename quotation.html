<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quotation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#eef1ff;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;padding:20px;border-radius:10px}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#2b3cff;color:#fff}
input[type=text],input[type=number]{width:100%;border:none}
img.design{max-width:80px;max-height:80px;display:block;margin:auto}
button{padding:8px 15px;margin:10px;border:none;background:#2b3cff;color:#fff;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
<div class="container" id="quote">
<h2 style="text-align:center">QUOTATION</h2>

<table id="itemTable">
<thead>
<tr>
<th>SN</th>
<th>Description</th>
<th>Design</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
<th>Delete</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="addItem()">Add Item</button>
<button onclick="downloadPDF()">Download PDF</button>
<button onclick="shareQuote()">Share</button>
</div>

<script>
function updateSerial(){
 document.querySelectorAll('#itemTable tbody tr').forEach((row,i)=>{
   row.querySelector('.sn').innerText=i+1;
 });
}

function calc(row){
 const q=row.querySelector('.qty').value||0;
 const r=row.querySelector('.rate').value||0;
 row.querySelector('.amt').value=q*r;
}

function deleteRow(btn){
 btn.closest('tr').remove();
 updateSerial();
}

function preview(input,img){
 if(input.files[0]){
   img.src=URL.createObjectURL(input.files[0]);
 }
}

function addItem(){
 const tbody=document.querySelector('#itemTable tbody');
 const tr=document.createElement('tr');
 tr.innerHTML=`
 <td class="sn"></td>
 <td><input type="text"></td>
 <td>
   <input type="file" onchange="preview(this,this.nextElementSibling)">
   <img class="design">
 </td>
 <td><input type="text"></td>
 <td><input class="qty" type="number" oninput="calc(this.parentElement.parentElement)"></td>
 <td><input class="rate" type="number" oninput="calc(this.parentElement.parentElement)"></td>
 <td><input class="amt" type="number" readonly></td>
 <td><button onclick="deleteRow(this)">X</button></td>`;
 tbody.appendChild(tr);
 updateSerial();
}

async function downloadPDF(){
 const {jsPDF}=window.jspdf;
 const element=document.getElementById('quote');
 const canvas=await html2canvas(element,{scale:2,useCORS:true,windowWidth:element.scrollWidth,windowHeight:element.scrollHeight});
 const img=canvas.toDataURL('image/png');
 const pdf=new jsPDF('p','mm','a4');
 const w=pdf.internal.pageSize.getWidth();
 const h=canvas.height*w/canvas.width;
 pdf.addImage(img,'PNG',0,0,w,h);
 pdf.save('quotation.pdf');
}

async function shareQuote(){
 const element=document.getElementById('quote');
 const canvas=await html2canvas(element,{scale:2,useCORS:true,windowWidth:element.scrollWidth,windowHeight:element.scrollHeight});
 const img=canvas.toDataURL('image/png');
 if(navigator.share){
   const res=await fetch(img);
   const blob=await res.blob();
   const file=new File([blob],'quotation.png',{type:'image/png'});
   navigator.share({files:[file],title:'Quotation'});
 }else{
   window.open(img);
 }
}
</script>
</body>
</html>
