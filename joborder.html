<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Premium Quotation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:'Segoe UI',Arial;background:linear-gradient(120deg,#e8ecff,#f5f7ff);margin:0;padding:20px}
.container{max-width:1100px;margin:auto;background:#fff;padding:22px;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.12)}
button{padding:8px 18px;border:none;border-radius:8px;background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;margin:6px 6px 6px 0;cursor:pointer;font-weight:600}
.table{width:100%;border-collapse:collapse;margin-top:14px;font-size:14px}
.table th{background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;padding:12px}
.table td{border:1px solid #e3e7f1;padding:9px;text-align:center;position:relative}

/* DESIGN CELL */
.designCell{width:140px;height:110px;overflow:hidden;position:relative;cursor:pointer;background:#f4f6ff;border-radius:8px}
.designCell span{font-size:12px;color:#7a86b6}
.designPreview{width:100%;height:100%;object-fit:cover;border-radius:8px;display:none}
.designInput{display:none}
.removeX{position:absolute;top:4px;right:6px;background:rgba(0,0,0,.6);color:#fff;border:none;border-radius:50%;width:22px;height:22px;font-size:14px;cursor:pointer;display:none}
.designCell.hasImage:hover .removeX{display:block}

tr:hover .rowDelete{display:inline-block}
.rowDelete{display:none;background:#ff4d4d;color:#fff;border:none;border-radius:50%;width:26px;height:26px;position:absolute;top:4px;left:4px;cursor:pointer}

.total-box{margin-top:18px;text-align:right;font-size:20px;font-weight:700;color:#1f3674}
</style>
</head>
<body>

<div class="container">

<button onclick="addRow()">Add Item</button>
<button onclick="undoDelete()" id="undoBtn" style="display:none;background:#ff9800">Undo</button>

<table class="table" id="qTable">
<tr>
<th>S.No</th>
<th>Description</th>
<th>Design</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
</tr>
</table>

<div class="total-box">
Grand Total: Rs. <span id="grandTotal">0.00</span>
</div>

</div>

<script>
let count=0
let lastDeletedRow=null
const table=document.getElementById('qTable')

function addRow(){
 count++
 let row=table.insertRow()
 row.innerHTML=`
 <td style='position:relative'>${count}
   <button class='rowDelete' onclick='deleteRow(this)'>×</button>
 </td>
 <td contenteditable='true'></td>
 <td class='designCell' onclick='triggerFile(this)'>
   <span>Click to Upload</span>
   <input type='file' accept='image/*' class='designInput'>
   <img class='designPreview'>
   <button type='button' class='removeX' onclick='removePhoto(this,event)'>×</button>
 </td>
 <td contenteditable='true'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td class='amount'>0.00</td>`
}

function triggerFile(cell){
 const input=cell.querySelector('.designInput')
 input.click()
}

function deleteRow(btn){
 const row=btn.closest('tr')
 lastDeletedRow=row.cloneNode(true)
 row.remove()
 renumber()
 calculateTotal()
 document.getElementById('undoBtn').style.display='inline-block'
}

function undoDelete(){
 if(!lastDeletedRow) return
 table.appendChild(lastDeletedRow)
 lastDeletedRow=null
 renumber()
 calculateTotal()
 document.getElementById('undoBtn').style.display='none'
}

function renumber(){
 let i=1
 document.querySelectorAll('#qTable tr').forEach((r,index)=>{
   if(index===0) return
   r.cells[0].childNodes[0].nodeValue=i
   i++
 })
 count=i-1
}

function calculate(el){
 const row=el.closest('tr')
 const qty=parseFloat(row.cells[4].querySelector('input').value)||0
 const rate=parseFloat(row.cells[5].querySelector('input').value)||0
 row.querySelector('.amount').innerText=(qty*rate).toFixed(2)
 calculateTotal()
}

function calculateTotal(){
 let total=0
 document.querySelectorAll('.amount').forEach(c=>{
   total+=parseFloat(c.innerText)||0
 })
 document.getElementById('grandTotal').innerText=total.toFixed(2)
}

function removePhoto(btn,e){
 e.stopPropagation()
 const cell=btn.closest('td')
 const img=cell.querySelector('.designPreview')
 const input=cell.querySelector('.designInput')
 const text=cell.querySelector('span')
 img.src=''
 img.style.display='none'
 text.style.display='block'
 cell.classList.remove('hasImage')
 input.value=''
}

// preview design image
 document.addEventListener('change',e=>{
  if(e.target.classList.contains('designInput') && e.target.files[0]){
    const cell=e.target.closest('td')
    const img=cell.querySelector('.designPreview')
    const text=cell.querySelector('span')
    img.src=URL.createObjectURL(e.target.files[0])
    img.style.display='block'
    text.style.display='none'
    cell.classList.add('hasImage')
  }
 })

window.onload=()=>console.log('Quotation Ready')
</script>

</body>
</html>
