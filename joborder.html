<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Premium Quotation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:'Segoe UI',Arial;background:linear-gradient(120deg,#e8ecff,#f5f7ff);margin:0;padding:20px}
.container{max-width:1100px;margin:auto;background:#fff;padding:22px;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.12)}
.header{display:grid;grid-template-columns:1fr 1fr 1fr;align-items:center;gap:10px;margin-bottom:18px;padding:14px 0;border-bottom:2px solid #edf0f7}
.logo{display:none}
.logo img{max-height:100px;max-width:220px;object-fit:contain;display:none}
.fileBtn{padding:6px 14px;background:#e9edff;border-radius:6px;border:1px solid #cfd6ff;cursor:pointer;font-size:13px;display:inline-block}
.fileBtn input{display:none}
.quote-badge{font-size:28px;font-weight:800;color:#2d4da5;letter-spacing:1px;text-align:center}
.quote-info{justify-self:end;text-align:right}
.info-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:10px;font-size:14px}
button{padding:8px 18px;border:none;border-radius:8px;background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;margin:6px 6px 6px 0;cursor:pointer;font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,.15)}
.table{width:100%;border-collapse:collapse;margin-top:14px;font-size:14px}
.table th{background:linear-gradient(90deg,#2d4da5,#4b6fe0);color:#fff;padding:12px}
.table td{border:1px solid #e3e7f1;padding:9px;text-align:center}
.table tr:nth-child(even){background:#f7f9ff}
input[type='number']{width:70px;padding:5px;border-radius:6px;border:1px solid #ccc}
.designPreview{max-width:90px;max-height:90px;object-fit:cover;margin:6px auto 0 auto;border-radius:8px;display:none}
.designCell{display:flex;flex-direction:column;align-items:center;justify-content:center}
.footer{margin-top:25px;font-size:13px;color:#555;border-top:1px dashed #ddd;padding-top:12px}
.total-box{margin-top:18px;text-align:right;font-size:20px;font-weight:700;color:#1f3674}
b{color:#2d4da5}
@media(max-width:768px){
.header{grid-template-columns:1fr}
.info-grid{grid-template-columns:1fr}
.table{font-size:12px}
}
@media print{button,.fileBtn{display:none !important;}body{background:#fff;padding:0}.container{box-shadow:none;border-radius:0}}
</style>
</head>
<body>

<div class="container">

<div class="header">
  <div></div>
  <div contenteditable="true" class="quote-badge">QUOTATION</div>
  <div class="quote-info"></div>
</div>

<div class="info-grid">
  <div>
    <b>Company Details</b><br>
    Company Name: <span contenteditable="true"></span><br>
    Address: <span contenteditable="true"></span><br>
    Phone: <span contenteditable="true"></span>
  </div>

  <div>
    <b>Buyer Details</b><br>
    Buyer Name: <span contenteditable="true"></span><br>
    Address: <span contenteditable="true"></span><br>
    Phone: <span contenteditable="true"></span>
  </div>

  <div style="text-align:right">
    <b>Quotation Info</b><br>
    Quotation No: <span contenteditable="true"></span><br>
    Date: <span contenteditable="true"></span>
  </div>
</div>

<button onclick="addRow()">Add Item</button>
<button onclick="window.print()">Print</button>
<button onclick="downloadPDF()">Download PDF</button>

<table class="table" id="qTable">
<tr>
<th>S.No</th>
<th>Description</th>
<th>Design</th>
<th>Size</th>
<th>Qty</th>
<th>Rate</th>
<th>Amount</th>
<th>Action</th>
</tr>
</table>

<div class="total-box">
Grand Total: Rs. <span id="grandTotal">0.00</span>
</div>

<div class="footer">
<br>
Prepared By: <span contenteditable="true" style="border-bottom:1px solid #aaa;min-width:120px;display:inline-block"></span>
<br><br>
<div style="text-align:left">
  <label class="fileBtn">Upload Logo
    <input type="file" id="logoInput" accept="image/*">
  </label>
  <br>
  <img id="companyLogo" style="max-height:100px;display:none;margin-top:8px">
</div>
<br>
<br><br>
<b>Terms & Conditions</b><br>
1. Goods once sold not returnable.<br>
2. 50% advance required.<br>
3. Delivery within 7 days.
</div>

</div>

<script>
let count=0;
const table=document.getElementById('qTable');

function addRow(){
 count++;
 let row=table.insertRow();
 row.innerHTML=`
 <td>${count}</td>
 <td contenteditable='true'></td>
 <td class='designCell'>
   <label class='fileBtn uploadDesignBtn'>Upload Design <input type='file' accept='image/*' class='designInput'></label>
   <img class='designPreview'>
 </td>
 <td contenteditable='true'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td><input type='number' min='0' oninput='calculate(this)'></td>
 <td class='amount'>0.00</td>
 <td><button onclick='deleteRow(this)'>Delete</button></td>
 `;
}

function deleteRow(btn){
 btn.closest('tr').remove();
 renumber();
 calculateTotal();
}

function renumber(){
 let rows=table.querySelectorAll('tr');
 rows.forEach((r,i)=>{if(i>0) r.cells[0].innerText=i;});
 count=rows.length-1;
}

function calculate(input){
 let row=input.closest('tr');
 let qty=parseFloat(row.cells[4].querySelector('input').value)||0;
 let rate=parseFloat(row.cells[5].querySelector('input').value)||0;
 let amount=qty*rate;
 row.querySelector('.amount').innerText=amount.toFixed(2);
 calculateTotal();
}

function calculateTotal(){
 let total=0;
 document.querySelectorAll('.amount').forEach(cell=>{
  total+=parseFloat(cell.innerText)||0;
 });
 document.getElementById('grandTotal').innerText=total.toFixed(2);
}

function downloadPDF(){
 window.print();
}

// SAFE logo preview (fix null error even if DOM changes)
function previewLogoFile(file){
 let img=document.getElementById('companyLogo');
 // if logo img missing, create it dynamically
 if(!img){
   const logoDiv=document.querySelector('.logo');
   if(logoDiv){
     img=document.createElement('img');
     img.id='companyLogo';
     img.alt='Company Logo';
     logoDiv.appendChild(img);
   }else{
     return;
   }
 }
 const reader=new FileReader();
 reader.onload=function(e){
   img.src=e.target.result;
   img.style.display='block';
   const label=img.parentElement.querySelector('.uploadDesignBtn');
   if(label) label.style.display='none';
 };
 reader.readAsDataURL(file);
}

// SAFE design preview
function previewDesignFile(input,file){
 const container=input.closest('td');
 if(!container) return;
 let img=container.querySelector('.designPreview');
 if(!img){
   img=document.createElement('img');
   img.className='designPreview';
   container.appendChild(img);
 }
 const reader=new FileReader();
 reader.onload=function(e){
   img.src=e.target.result;
   img.style.display='block';
   const label=img.parentElement.querySelector('.uploadDesignBtn');
   if(label) label.style.display='none';
 };
 reader.readAsDataURL(file);
}

// Event delegation (prevents null issues)
document.addEventListener('change',function(e){
 if(e.target.id==='logoInput' && e.target.files && e.target.files[0]){
   previewLogoFile(e.target.files[0]);
 }
 if(e.target.classList.contains('designInput') && e.target.files && e.target.files[0]){
   previewDesignFile(e.target,e.target.files[0]);
 }
});

// BASIC TESTS
function runTests(){
 console.log('TEST 1: Add row');
 addRow();
 console.assert(document.querySelectorAll('#qTable tr').length>1,'Row not added');

 console.log('TEST 2: Total calculation');
 const row=document.querySelectorAll('#qTable tr')[1];
 row.cells[4].querySelector('input').value=2;
 row.cells[5].querySelector('input').value=50;
 calculate(row.cells[4].querySelector('input'));
 console.assert(parseFloat(document.getElementById('grandTotal').innerText)>=100,'Total wrong');

 console.log('All tests done');
}

window.onload=function(){
 addRow();
 setTimeout(runTests,500);
};
</script>

</body>
</html>
