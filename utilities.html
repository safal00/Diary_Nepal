<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Challan</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:40px;
}
h2{
  text-align:center;
  margin-bottom:5px;
}
input, select{
  padding:6px;
  margin:3px 0;
}
table{
  width:100%;
  border-collapse: collapse;
  margin-top:15px;
}
table, th, td{
  border:1px solid #000;
}
th, td{
  padding:8px;
  text-align:center;
}
.add-btn{
  margin-top:10px;
  padding:8px 15px;
  cursor:pointer;
}
.total-box{
  margin-top:15px;
  text-align:right;
}
.signature{
  margin-top:60px;
  display:flex;
  justify-content:space-between;
}
.hidden{
  display:none;
}
</style>
</head>
<body>

<h2>DELIVERY CHALLAN</h2>

<!-- Company Details -->
<b>Company Name:</b><br>
<input type="text" placeholder="Company Name"><br>

<b>Address:</b><br>
<input type="text" placeholder="Address"><br>

<b>Phone:</b><br>
<input type="text" placeholder="Phone"><br><br>

<!-- Challan Info -->
<table>
<tr>
<td>Challan No</td>
<td><input type="text"></td>
<td>Date (AD)</td>
<td><input type="date" id="adDate" onchange="convertDate()"></td>
</tr>

<tr>
<td>Date (BS)</td>
<td><input type="text" id="bsDate" readonly></td>
<td>Terms</td>
<td><input type="text"></td>
</tr>
</table>

<br>

<b>Buyer Details</b><br>
<input type="text" placeholder="Buyer Name"><br>
<input type="text" placeholder="Buyer Address"><br>
<input type="text" placeholder="Buyer Phone"><br>

<br>

<!-- Quantity Mode -->
<b>Quantity Type:</b>
<select id="qtyType" onchange="toggleMode()">
<option value="pcs">Pieces</option>
<option value="sqft">Square Feet</option>
<option value="size">Size Based</option>
</select>

<!-- Item Table -->
<table id="itemTable">
<thead>
<tr>
<th>SN</th>
<th>Description</th>
<th>Qty</th>
<th class="sizeCol hidden">Length</th>
<th class="sizeCol hidden">Width</th>
<th>Rate</th>
<th>Amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><input></td>
<td><input type="number" oninput="calc(this)"></td>
<td class="sizeCol hidden"><input type="number" oninput="calc(this)"></td>
<td class="sizeCol hidden"><input type="number" oninput="calc(this)"></td>
<td><input type="number" oninput="calc(this)"></td>
<td class="amount">0</td>
</tr>
</tbody>
</table>

<button class="add-btn" onclick="addRow()">+ Add Item</button>

<div class="total-box">
<b>Total: <span id="grandTotal">0</span></b>
</div>

<div class="signature">
<div>Receiver Signature</div>
<div>Authorized Signature</div>
</div>

<script>

function convertDate(){
  const ad = document.getElementById('adDate').value;
  if(ad){
    const date = new Date(ad);
    document.getElementById('bsDate').value =
      (date.getFullYear()+57) + '-' + (date.getMonth()+1) + '-' + date.getDate();
  }
}

function toggleMode(){
  const type = document.getElementById('qtyType').value;
  const cols = document.querySelectorAll('.sizeCol');

  cols.forEach(col=>{
    col.classList.toggle('hidden', type === 'pcs');
  });
}

function calc(el){
  const row = el.closest('tr');
  const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
  const len = row.cells[3].querySelector('input') ? parseFloat(row.cells[3].querySelector('input').value) || 0 : 0;
  const wid = row.cells[4].querySelector('input') ? parseFloat(row.cells[4].querySelector('input').value) || 0 : 0;
  const rate = parseFloat(row.cells[row.cells.length-2].querySelector('input').value) || 0;
  const type = document.getElementById('qtyType').value;

  let amount = 0;

  if(type === 'sqft' || type === 'size'){
    amount = qty * len * wid * rate;
  } else {
    amount = qty * rate;
  }

  row.querySelector('.amount').innerText = amount.toFixed(2);
  grandTotal();
}

function grandTotal(){
  let total = 0;
  document.querySelectorAll('.amount').forEach(a=>{
    total += parseFloat(a.innerText) || 0;
  });
  document.getElementById('grandTotal').innerText = total.toFixed(2);
}

function addRow(){
  const table = document.querySelector('#itemTable tbody');
  const rowCount = table.rows.length + 1;
  const newRow = table.rows[0].cloneNode(true);

  newRow.cells[0].innerText = rowCount;
  newRow.querySelectorAll('input').forEach(i=>i.value='');
  newRow.querySelector('.amount').innerText='0';

  table.appendChild(newRow);
}

</script>

</body>
</html>
